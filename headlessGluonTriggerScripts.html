# Don't Copy The File, just copy the scripts from within it
# and add them all to the bottom of the scripts for the page where the button of interest is

<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabase = supabase.createClient(
    'https://plxdnhrdiqqaiyiljzfm.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBseGRuaHJkaXFxYWl5aWxqemZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDg2ODAsImV4cCI6MjA2OTUyNDY4MH0.3WzHgqG85ajp3Lx4UEoT5MnQlOno400GXohT6HSdhv0'
  )
</script>

<script type="module">
  const button = document.getElementById('get-compute-btn');

  button?.addEventListener('click', async () => {
    try {
      const { data: { user }, error } = await supabase.auth.getUser();

      if (error || !user) {
        alert('You must be logged in to start a session.');
        return;
      }

      const response = await fetch('https://cw9ahgiyrl.execute-api.us-east-1.amazonaws.com/staging/launch', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user_id: user.id
        }),
      });

      if (!response.ok) {
        const err = await response.text();
        throw new Error(`Launch failed: ${err}`);
      }

      alert('Launching EC2 session...');
    } catch (err) {
      console.error(err);
      alert('Error starting session.');
    }
  });
</script>
